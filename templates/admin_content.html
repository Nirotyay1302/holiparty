{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">ğŸ¨ Content Management - Holi Party 2026</h2>

    <!-- Success/Error Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Event Details & Content</h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="event_date" class="form-label">Event Date</label>
                                    <input type="text" class="form-control" id="event_date" name="event_date" value="{{ content.event_date }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="event_time" class="form-label">Event Time</label>
                                    <input type="text" class="form-control" id="event_time" name="event_time" value="{{ content.event_time }}" required>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="venue" class="form-label">Venue</label>
                                    <input type="text" class="form-control" id="venue" name="venue" value="{{ content.venue }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="organizer" class="form-label">Organizer</label>
                                    <input type="text" class="form-control" id="organizer" name="organizer" value="{{ content.organizer }}" required>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="complimentary" class="form-label">Complimentary Items</label>
                            <input type="text" class="form-control" id="complimentary" name="complimentary" value="{{ content.complimentary }}" required>
                        </div>

                        <h6 class="mt-4 mb-3">Pricing Information</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="entry_pass" class="form-label">Entry Pass (â‚¹)</label>
                                    <input type="number" class="form-control" id="entry_pass" name="entry_pass" value="{{ content.pricing.entry_pass }}" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="entry_plus_starter" class="form-label">Entry + Starter (â‚¹)</label>
                                    <input type="number" class="form-control" id="entry_plus_starter" name="entry_plus_starter" value="{{ content.pricing.entry_plus_starter }}" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="entry_plus_starter_lunch" class="form-label">Entry + Starter + Lunch (â‚¹)</label>
                                    <input type="number" class="form-control" id="entry_plus_starter_lunch" name="entry_plus_starter_lunch" value="{{ content.pricing.get('entry_plus_starter_lunch', 499) }}" required>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <label for="food_available" class="form-label">Food Options</label>
                                    <input type="text" class="form-control" id="food_available" name="food_available" value="{{ content.pricing.food_available }}" required>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="offers" class="form-label">Current Offers/Special Announcements</label>
                            <textarea class="form-control" id="offers" name="offers" rows="3">{{ content.offers }}</textarea>
                        </div>

                        <h6 class="mt-4 mb-3">Images & Media</h6>
                        <div class="mb-3">
                            <label for="hero_image" class="form-label">Hero Image URL</label>
                            <input type="url" class="form-control" id="hero_image" name="hero_image" value="{{ content.hero_image }}">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Gallery Images (one URL per line)</label>
                            <textarea class="form-control" name="gallery_images" rows="5" placeholder="Enter image URLs, one per line">{% for img in content.gallery_images %}{{ img }}
{% endfor %}</textarea>
                        </div>

                        <button type="submit" class="btn btn-primary">Update Content</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <a href="{{ url_for('admin') }}" class="btn btn-outline-primary w-100 mb-2">ğŸ“Š View Bookings</a>
                    <a href="{{ url_for('export_bookings') }}" class="btn btn-outline-success w-100 mb-2">ğŸ“Š Export Bookings</a>
                    <a href="/" class="btn btn-outline-info w-100 mb-2" target="_blank">ğŸ  View Website</a>
                    <a href="{{ url_for('admin_login') }}" class="btn btn-outline-danger w-100">ğŸšª Logout</a>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h6 class="mb-0">Current Settings Preview</h6>
                </div>
                <div class="card-body">
                    <p><strong>Date:</strong> {{ content.event_date }}</p>
                    <p><strong>Time:</strong> {{ content.event_time }}</p>
                    <p><strong>Venue:</strong> {{ content.venue }}</p>
                    <p><strong>Organizer:</strong> {{ content.organizer }}</p>
                    <p><strong>Entry:</strong> â‚¹{{ content.pricing.entry_pass }}</p>
                    <p><strong>Entry + Starter:</strong> â‚¹{{ content.pricing.entry_plus_starter }}</p>
                    <p><strong>Entry + Starter + Lunch:</strong> â‚¹{{ content.pricing.get('entry_plus_starter_lunch', 499) }}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Handle gallery images textarea
document.querySelector('form').addEventListener('submit', function(e) {
    const galleryTextarea = document.querySelector('[name="gallery_images"]');
    const galleryImages = galleryTextarea.value.trim().split('\n').filter(url => url.trim());
    
    // Clear existing hidden inputs
    document.querySelectorAll('input[name="gallery_images[]"]').forEach(input => input.remove());
    
    // Add hidden inputs for each gallery image
    galleryImages.forEach(url => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'gallery_images[]';
        input.value = url.trim();
        this.appendChild(input);
    });
});
</script>
{% endblock %}